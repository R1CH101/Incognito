---
import { Icon } from 'astro-icon/components';
---

<script>
    import { navigate } from 'astro:transitions/client'; 
    function defineVars() {
        const iframe = document.getElementById("iframe") as HTMLIFrameElement;
        const win = iframe.contentWindow;
        //return both the iframe and the iframe's window
        //Usage: [variable].iframe or [variable].win
        return { iframe, win }
    }
    window.createLink = function() {
        const vars = defineVars();
        if (vars?.win?.__uv) {
            navigator.clipboard.writeText(new URL('./?link=' + encodeURIComponent(__uv$config.encodeUrl!(vars?.win?.__uv.location.href)), location.href).href);
        } 
    }
    window.exitIframe = function() {
        const vars = defineVars();
        if (vars?.win?.__uv || vars?.win?.__get$ProxyUrl) {
            navigate("/");
        }
    }
    window.refreshIframe = function() {
        const vars = defineVars();
        if (vars?.win?.__uv || vars?.win?.__get$ProxyUrl) {
            vars?.win?.location.reload();
        }
    }
    window.setTitle = function() {
        const vars = defineVars();
        if (vars?.win && vars?.win?.__uv || vars?.win?.__get$ProxyUrl) {
            //@ts-ignore this is really complicated and I am not in the mood to deal with it
            document.getElementById("title").value = Object.getOwnPropertyDescriptor(Document.prototype, 'title').get.call(vars?.win.document);
        }
        if (localStorage.getItem("incog||proxy") === "rh") {
            const linkElement = document.getElementById("createlink") as HTMLButtonElement;
            linkElement.classList.add("hidden");
        }
    }
</script>
